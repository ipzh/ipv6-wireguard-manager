# 前端目录说明

## 📁 安装后前端目录位置

### 默认前端目录

根据安装脚本配置，**默认前端目录**是：

```
/var/www/html
```

这是Nginx的标准Web根目录。

---

## 🔍 目录检测逻辑

安装脚本会自动检测并选择前端目录：

1. **优先**: `/var/www/html`（Nginx标准目录）
2. **备选**: `/usr/share/nginx/html`（如果第一个不存在）
3. **回退**: `${INSTALL_DIR}/web`（如果前两个都不存在）

---

## 📂 目录结构

安装后，前端文件会被复制到前端目录，结构如下：

```
/var/www/html/
├── index.php                    # 入口文件
├── config/                      # 配置文件
│   ├── config.php
│   ├── database.php
│   ├── api_paths.json
│   └── assets.php
├── classes/                     # PHP类库
│   ├── Router.php
│   ├── ApiClientJWT.php
│   ├── AuthJWT.php
│   └── ...
├── controllers/                 # 控制器
│   ├── AuthController.php
│   ├── DashboardController.php
│   └── ...
├── views/                       # 视图模板
│   ├── auth/
│   ├── dashboard/
│   └── ...
├── includes/                    # 包含文件
│   ├── ApiPathBuilder/
│   └── ssl_security.php
├── assets/                      # 静态资源（CSS、JS、图片）
│   ├── css/
│   ├── js/
│   └── img/
├── logs/                        # 日志文件
│   ├── error.log
│   ├── access.log
│   └── debug.log
└── api_proxy.php                # API代理文件
```

---

## 🛠️ 自定义前端目录

如果默认目录不符合需求，可以通过参数指定：

```bash
# 安装时指定自定义前端目录
sudo ./install.sh --frontend-dir /custom/path/to/web
```

---

## 📝 安装过程

安装脚本执行 `deploy_php_frontend()` 函数时：

1. **检查目录**：如果 `$FRONTEND_DIR` 不存在，则创建
2. **复制文件**：将 `$INSTALL_DIR/php-frontend/*` 复制到 `$FRONTEND_DIR/`
3. **创建日志目录**：在 `$FRONTEND_DIR/logs/` 创建日志文件
4. **设置权限**：配置适当的文件权限和所有者

关键代码：

```bash
# 从 install.sh
deploy_php_frontend() {
    log_info "部署PHP前端到 $FRONTEND_DIR..."
    
    if [[ ! -d "$FRONTEND_DIR" ]]; then
        mkdir -p "$FRONTEND_DIR"
    fi
    
    # 复制前端文件到 /var/www/html
    if [[ -d "$INSTALL_DIR/php-frontend" ]]; then
        cp -r "$INSTALL_DIR/php-frontend"/* "$FRONTEND_DIR/"
        log_success "前端文件复制到 $FRONTEND_DIR"
    else
        log_error "前端源码目录不存在: $INSTALL_DIR/php-frontend"
        return 1
    fi
}
```

---

## 🔧 Nginx配置

Nginx配置中的 `root` 指令指向前端目录：

```nginx
server {
    listen 80;
    server_name _;
    root /var/www/html;          # 前端目录
    index index.php index.html;
    
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }
    
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

---

## ✅ 验证安装

安装后，可以通过以下方式验证前端目录：

```bash
# 检查目录是否存在
ls -la /var/www/html

# 检查关键文件
ls -la /var/www/html/index.php
ls -la /var/www/html/config/config.php

# 检查权限
stat /var/www/html

# 检查Nginx配置
cat /etc/nginx/sites-available/ipv6-wireguard-manager | grep root
```

---

## 📊 目录权限

安装脚本会设置适当的权限：

- **目录权限**: 755
- **文件权限**: 644（普通文件）、755（可执行文件）
- **日志目录**: 775（可写）
- **所有者**: `www-data:www-data`（或Nginx配置的用户）

---

## 🚨 常见问题

### 1. 目录不存在

如果 `/var/www/html` 不存在，脚本会自动创建：

```bash
mkdir -p /var/www/html
```

### 2. 权限问题

如果遇到权限问题，检查所有者：

```bash
sudo chown -R www-data:www-data /var/www/html
sudo chmod -R 755 /var/www/html
```

### 3. 自定义目录

如果使用自定义目录，确保：
- Nginx配置中的 `root` 指令指向正确路径
- PHP-FPM有读取权限
- 目录存在且可访问

---

## 📝 总结

- **默认前端目录**: `/var/www/html`
- **安装位置**: 安装脚本会将 `php-frontend/` 内容复制到前端目录
- **Nginx配置**: `root` 指令指向前端目录
- **自定义**: 可通过 `--frontend-dir` 参数指定

---

**最后更新**: 2024-11-01


# å‰ç«¯ç›®å½•è¯´æ˜

## ğŸ“ å®‰è£…åå‰ç«¯ç›®å½•ä½ç½®

### é»˜è®¤å‰ç«¯ç›®å½•

æ ¹æ®å®‰è£…è„šæœ¬é…ç½®ï¼Œ**é»˜è®¤å‰ç«¯ç›®å½•**æ˜¯ï¼š

```
/var/www/html
```

è¿™æ˜¯Nginxçš„æ ‡å‡†Webæ ¹ç›®å½•ã€‚

---

## ğŸ” ç›®å½•æ£€æµ‹é€»è¾‘

å®‰è£…è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶é€‰æ‹©å‰ç«¯ç›®å½•ï¼š

1. **ä¼˜å…ˆ**: `/var/www/html`ï¼ˆNginxæ ‡å‡†ç›®å½•ï¼‰
2. **å¤‡é€‰**: `/usr/share/nginx/html`ï¼ˆå¦‚æœç¬¬ä¸€ä¸ªä¸å­˜åœ¨ï¼‰
3. **å›é€€**: `${INSTALL_DIR}/web`ï¼ˆå¦‚æœå‰ä¸¤ä¸ªéƒ½ä¸å­˜åœ¨ï¼‰

---

## ğŸ“‚ ç›®å½•ç»“æ„

å®‰è£…åï¼Œå‰ç«¯æ–‡ä»¶ä¼šè¢«å¤åˆ¶åˆ°å‰ç«¯ç›®å½•ï¼Œç»“æ„å¦‚ä¸‹ï¼š

```
/var/www/html/
â”œâ”€â”€ index.php                    # å…¥å£æ–‡ä»¶
â”œâ”€â”€ config/                      # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.php
â”‚   â”œâ”€â”€ database.php
â”‚   â”œâ”€â”€ api_paths.json
â”‚   â””â”€â”€ assets.php
â”œâ”€â”€ classes/                     # PHPç±»åº“
â”‚   â”œâ”€â”€ Router.php
â”‚   â”œâ”€â”€ ApiClientJWT.php
â”‚   â”œâ”€â”€ AuthJWT.php
â”‚   â””â”€â”€ ...
â”œâ”€â”€ controllers/                 # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ AuthController.php
â”‚   â”œâ”€â”€ DashboardController.php
â”‚   â””â”€â”€ ...
â”œâ”€â”€ views/                       # è§†å›¾æ¨¡æ¿
â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ dashboard/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ includes/                    # åŒ…å«æ–‡ä»¶
â”‚   â”œâ”€â”€ ApiPathBuilder/
â”‚   â””â”€â”€ ssl_security.php
â”œâ”€â”€ assets/                      # é™æ€èµ„æºï¼ˆCSSã€JSã€å›¾ç‰‡ï¼‰
â”‚   â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ js/
â”‚   â””â”€â”€ img/
â”œâ”€â”€ logs/                        # æ—¥å¿—æ–‡ä»¶
â”‚   â”œâ”€â”€ error.log
â”‚   â”œâ”€â”€ access.log
â”‚   â””â”€â”€ debug.log
â””â”€â”€ api_proxy.php                # APIä»£ç†æ–‡ä»¶
```

---

## ğŸ› ï¸ è‡ªå®šä¹‰å‰ç«¯ç›®å½•

å¦‚æœé»˜è®¤ç›®å½•ä¸ç¬¦åˆéœ€æ±‚ï¼Œå¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šï¼š

```bash
# å®‰è£…æ—¶æŒ‡å®šè‡ªå®šä¹‰å‰ç«¯ç›®å½•
sudo ./install.sh --frontend-dir /custom/path/to/web
```

---

## ğŸ“ å®‰è£…è¿‡ç¨‹

å®‰è£…è„šæœ¬æ‰§è¡Œ `deploy_php_frontend()` å‡½æ•°æ—¶ï¼š

1. **æ£€æŸ¥ç›®å½•**ï¼šå¦‚æœ `$FRONTEND_DIR` ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º
2. **å¤åˆ¶æ–‡ä»¶**ï¼šå°† `$INSTALL_DIR/php-frontend/*` å¤åˆ¶åˆ° `$FRONTEND_DIR/`
3. **åˆ›å»ºæ—¥å¿—ç›®å½•**ï¼šåœ¨ `$FRONTEND_DIR/logs/` åˆ›å»ºæ—¥å¿—æ–‡ä»¶
4. **è®¾ç½®æƒé™**ï¼šé…ç½®é€‚å½“çš„æ–‡ä»¶æƒé™å’Œæ‰€æœ‰è€…

å…³é”®ä»£ç ï¼š

```bash
# ä» install.sh
deploy_php_frontend() {
    log_info "éƒ¨ç½²PHPå‰ç«¯åˆ° $FRONTEND_DIR..."
    
    if [[ ! -d "$FRONTEND_DIR" ]]; then
        mkdir -p "$FRONTEND_DIR"
    fi
    
    # å¤åˆ¶å‰ç«¯æ–‡ä»¶åˆ° /var/www/html
    if [[ -d "$INSTALL_DIR/php-frontend" ]]; then
        cp -r "$INSTALL_DIR/php-frontend"/* "$FRONTEND_DIR/"
        log_success "å‰ç«¯æ–‡ä»¶å¤åˆ¶åˆ° $FRONTEND_DIR"
    else
        log_error "å‰ç«¯æºç ç›®å½•ä¸å­˜åœ¨: $INSTALL_DIR/php-frontend"
        return 1
    fi
}
```

---

## ğŸ”§ Nginxé…ç½®

Nginxé…ç½®ä¸­çš„ `root` æŒ‡ä»¤æŒ‡å‘å‰ç«¯ç›®å½•ï¼š

```nginx
server {
    listen 80;
    server_name _;
    root /var/www/html;          # å‰ç«¯ç›®å½•
    index index.php index.html;
    
    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }
    
    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.2-fpm.sock;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
}
```

---

## âœ… éªŒè¯å®‰è£…

å®‰è£…åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯å‰ç«¯ç›®å½•ï¼š

```bash
# æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨
ls -la /var/www/html

# æ£€æŸ¥å…³é”®æ–‡ä»¶
ls -la /var/www/html/index.php
ls -la /var/www/html/config/config.php

# æ£€æŸ¥æƒé™
stat /var/www/html

# æ£€æŸ¥Nginxé…ç½®
cat /etc/nginx/sites-available/ipv6-wireguard-manager | grep root
```

---

## ğŸ“Š ç›®å½•æƒé™

å®‰è£…è„šæœ¬ä¼šè®¾ç½®é€‚å½“çš„æƒé™ï¼š

- **ç›®å½•æƒé™**: 755
- **æ–‡ä»¶æƒé™**: 644ï¼ˆæ™®é€šæ–‡ä»¶ï¼‰ã€755ï¼ˆå¯æ‰§è¡Œæ–‡ä»¶ï¼‰
- **æ—¥å¿—ç›®å½•**: 775ï¼ˆå¯å†™ï¼‰
- **æ‰€æœ‰è€…**: `www-data:www-data`ï¼ˆæˆ–Nginxé…ç½®çš„ç”¨æˆ·ï¼‰

---

## ğŸš¨ å¸¸è§é—®é¢˜

### 1. ç›®å½•ä¸å­˜åœ¨

å¦‚æœ `/var/www/html` ä¸å­˜åœ¨ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨åˆ›å»ºï¼š

```bash
mkdir -p /var/www/html
```

### 2. æƒé™é—®é¢˜

å¦‚æœé‡åˆ°æƒé™é—®é¢˜ï¼Œæ£€æŸ¥æ‰€æœ‰è€…ï¼š

```bash
sudo chown -R www-data:www-data /var/www/html
sudo chmod -R 755 /var/www/html
```

### 3. è‡ªå®šä¹‰ç›®å½•

å¦‚æœä½¿ç”¨è‡ªå®šä¹‰ç›®å½•ï¼Œç¡®ä¿ï¼š
- Nginxé…ç½®ä¸­çš„ `root` æŒ‡ä»¤æŒ‡å‘æ­£ç¡®è·¯å¾„
- PHP-FPMæœ‰è¯»å–æƒé™
- ç›®å½•å­˜åœ¨ä¸”å¯è®¿é—®

---

## ğŸ“ æ€»ç»“

- **é»˜è®¤å‰ç«¯ç›®å½•**: `/var/www/html`
- **å®‰è£…ä½ç½®**: å®‰è£…è„šæœ¬ä¼šå°† `php-frontend/` å†…å®¹å¤åˆ¶åˆ°å‰ç«¯ç›®å½•
- **Nginxé…ç½®**: `root` æŒ‡ä»¤æŒ‡å‘å‰ç«¯ç›®å½•
- **è‡ªå®šä¹‰**: å¯é€šè¿‡ `--frontend-dir` å‚æ•°æŒ‡å®š

---

**æœ€åæ›´æ–°**: 2024-11-01


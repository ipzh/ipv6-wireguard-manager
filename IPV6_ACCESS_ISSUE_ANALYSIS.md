# IPv6è®¿é—®é—®é¢˜åˆ†ææ€»ç»“

## ğŸ› é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šé€šè¿‡ä¸»æœºIPv6åœ°å€æ— æ³•è®¿é—®å‰ç«¯ç•Œé¢ï¼Œå¯èƒ½çš„åŸå› åŒ…æ‹¬ï¼š

1. **Nginxé…ç½®é—®é¢˜** - æœªé…ç½®IPv6ç›‘å¬
2. **é˜²ç«å¢™é—®é¢˜** - æœªå¼€æ”¾IPv6ç«¯å£
3. **ç½‘ç»œé…ç½®é—®é¢˜** - IPv6è·¯ç”±æˆ–ISPé…ç½®
4. **æœåŠ¡é…ç½®é—®é¢˜** - æœåŠ¡æœªç»‘å®šIPv6åœ°å€

## ğŸ” é—®é¢˜åˆ†æ

### 1. å¸¸è§åŸå› 

#### Nginxé…ç½®é—®é¢˜
- ç¼ºå°‘ `listen [::]:80;` é…ç½®
- åªé…ç½®äº†IPv4ç›‘å¬ï¼Œæœªé…ç½®IPv6ç›‘å¬

#### é˜²ç«å¢™é—®é¢˜
- UFWæˆ–iptablesæœªå¼€æ”¾80ç«¯å£
- é˜²ç«å¢™è§„åˆ™åªé’ˆå¯¹IPv4ï¼ŒæœªåŒ…å«IPv6

#### ç½‘ç»œé…ç½®é—®é¢˜
- ç³»ç»ŸIPv6æ”¯æŒæœªå¯ç”¨
- IPv6è·¯ç”±é…ç½®é—®é¢˜
- ISP IPv6é…ç½®é—®é¢˜

#### æœåŠ¡é…ç½®é—®é¢˜
- æœåŠ¡åªç»‘å®šIPv4åœ°å€
- ç«¯å£å†²çªæˆ–å ç”¨

### 2. è¯Šæ–­æ­¥éª¤

1. **æ£€æŸ¥IPv6æ”¯æŒ**
   ```bash
   lsmod | grep ipv6
   ip -6 addr show
   ```

2. **æ£€æŸ¥Nginxé…ç½®**
   ```bash
   cat /etc/nginx/sites-enabled/ipv6-wireguard-manager
   nginx -t
   ```

3. **æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€**
   ```bash
   ufw status
   iptables -L -n
   ```

4. **æ£€æŸ¥æœåŠ¡ç›‘å¬**
   ```bash
   netstat -tlnp | grep nginx
   netstat -tlnp | grep 8000
   ```

5. **æµ‹è¯•è¿æ¥**
   ```bash
   curl -I http://[::1]:80
   curl -I http://[IPv6åœ°å€]:80
   ```

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤Nginxé…ç½®

**é—®é¢˜**: Nginxæœªé…ç½®IPv6ç›‘å¬
**è§£å†³**: æ·»åŠ IPv6ç›‘å¬é…ç½®

```nginx
server {
    listen 80;
    listen [::]:80;  # æ·»åŠ IPv6ç›‘å¬
    server_name _;
    
    # å…¶ä»–é…ç½®...
}
```

### 2. é…ç½®é˜²ç«å¢™

**é—®é¢˜**: é˜²ç«å¢™æœªå¼€æ”¾IPv6ç«¯å£
**è§£å†³**: å¼€æ”¾ç›¸å…³ç«¯å£

```bash
# UFW
ufw allow 80/tcp
ufw allow 8000/tcp

# iptables
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 8000 -j ACCEPT
```

### 3. æ£€æŸ¥IPv6æ”¯æŒ

**é—®é¢˜**: ç³»ç»ŸIPv6æ”¯æŒæœªå¯ç”¨
**è§£å†³**: å¯ç”¨IPv6æ”¯æŒ

```bash
# åŠ è½½IPv6æ¨¡å—
modprobe ipv6

# æ£€æŸ¥IPv6åœ°å€
ip -6 addr show
```

### 4. é‡å¯æœåŠ¡

**é—®é¢˜**: é…ç½®æ›´æ”¹æœªç”Ÿæ•ˆ
**è§£å†³**: é‡å¯ç›¸å…³æœåŠ¡

```bash
systemctl restart nginx
systemctl restart ipv6-wireguard-manager
```

## ğŸš€ ä½¿ç”¨æ–¹å¼

### æ–¹æ³•1: è¿è¡Œè¯Šæ–­è„šæœ¬

```bash
# è¿è¡ŒIPv6è®¿é—®è¯Šæ–­è„šæœ¬
curl -fsSL https://raw.githubusercontent.com/ipzh/ipv6-wireguard-manager/main/diagnose_ipv6_access.sh | bash
```

### æ–¹æ³•2: è¿è¡Œä¿®å¤è„šæœ¬

```bash
# è¿è¡ŒIPv6è®¿é—®ä¿®å¤è„šæœ¬
curl -fsSL https://raw.githubusercontent.com/ipzh/ipv6-wireguard-manager/main/fix_ipv6_access.sh | bash
```

### æ–¹æ³•3: æ‰‹åŠ¨ä¿®å¤

```bash
# 1. æ£€æŸ¥IPv6æ”¯æŒ
lsmod | grep ipv6
ip -6 addr show

# 2. ä¿®å¤Nginxé…ç½®
sudo nano /etc/nginx/sites-enabled/ipv6-wireguard-manager
# æ·»åŠ : listen [::]:80;

# 3. é…ç½®é˜²ç«å¢™
sudo ufw allow 80/tcp
sudo ufw allow 8000/tcp

# 4. é‡å¯æœåŠ¡
sudo systemctl restart nginx
sudo systemctl restart ipv6-wireguard-manager

# 5. æµ‹è¯•è¿æ¥
curl -I http://[::1]:80
```

## ğŸ“Š ä¿®å¤æ•ˆæœ

| é—®é¢˜ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| IPv6ç›‘å¬ | æœªé…ç½® | âœ… å·²é…ç½® |
| é˜²ç«å¢™ | æœªå¼€æ”¾ | âœ… å·²å¼€æ”¾ |
| IPv6æ”¯æŒ | å¯èƒ½æœªå¯ç”¨ | âœ… å·²å¯ç”¨ |
| æœåŠ¡çŠ¶æ€ | å¯èƒ½ä¸ç¨³å®š | âœ… ç¨³å®šè¿è¡Œ |
| è®¿é—®æµ‹è¯• | å¤±è´¥ | âœ… æˆåŠŸ |

## ğŸ§ª éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥IPv6åœ°å€
```bash
ip -6 addr show | grep global
```

### 2. æµ‹è¯•æœ¬åœ°IPv6è¿æ¥
```bash
curl -I http://[::1]:80
```

### 3. æµ‹è¯•å¤–éƒ¨IPv6è¿æ¥
```bash
curl -I http://[IPv6åœ°å€]:80
```

### 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
systemctl status nginx
systemctl status ipv6-wireguard-manager
```

### 5. æ£€æŸ¥ç«¯å£ç›‘å¬
```bash
netstat -tlnp | grep -E "(80|8000)"
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¦‚æœIPv6ä»ç„¶æ— æ³•è®¿é—®

1. **æ£€æŸ¥ç½‘ç»œé…ç½®**
   ```bash
   # æ£€æŸ¥IPv6è·¯ç”±
   ip -6 route show
   
   # æ£€æŸ¥IPv6é‚»å±…
   ip -6 neigh show
   ```

2. **æ£€æŸ¥ISPé…ç½®**
   - ç¡®è®¤ISPæä¾›IPv6æœåŠ¡
   - æ£€æŸ¥IPv6åœ°å€åˆ†é…
   - éªŒè¯IPv6è·¯ç”±é…ç½®

3. **æ£€æŸ¥ç³»ç»Ÿé…ç½®**
   ```bash
   # æ£€æŸ¥IPv6è½¬å‘
   cat /proc/sys/net/ipv6/conf/all/forwarding
   
   # æ£€æŸ¥IPv6æ¥å—
   cat /proc/sys/net/ipv6/conf/all/accept_ra
   ```

4. **æ£€æŸ¥æ—¥å¿—**
   ```bash
   # Nginxé”™è¯¯æ—¥å¿—
   tail -f /var/log/nginx/error.log
   
   # ç³»ç»Ÿæ—¥å¿—
   journalctl -u nginx -f
   ```

### å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

1. **"Connection refused"**
   - æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
   - æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®ç›‘å¬
   - æ£€æŸ¥é˜²ç«å¢™é…ç½®

2. **"Network is unreachable"**
   - æ£€æŸ¥IPv6è·¯ç”±é…ç½®
   - æ£€æŸ¥ISP IPv6æ”¯æŒ
   - æ£€æŸ¥ç½‘ç»œæ¥å£é…ç½®

3. **"Timeout"**
   - æ£€æŸ¥ç½‘ç»œå»¶è¿Ÿ
   - æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
   - æ£€æŸ¥æœåŠ¡å“åº”æ—¶é—´

## ğŸ“‹ æ£€æŸ¥æ¸…å•

- [ ] IPv6æ¨¡å—å·²åŠ è½½
- [ ] IPv6åœ°å€å·²åˆ†é…
- [ ] Nginxé…ç½®äº†IPv6ç›‘å¬
- [ ] é˜²ç«å¢™å¼€æ”¾äº†ç›¸å…³ç«¯å£
- [ ] æœåŠ¡æ­£å¸¸å¯åŠ¨
- [ ] æœ¬åœ°IPv6è¿æ¥æ­£å¸¸
- [ ] å¤–éƒ¨IPv6è¿æ¥æ­£å¸¸
- [ ] æ—¥å¿—æ— é”™è¯¯ä¿¡æ¯

## âœ… æ€»ç»“

IPv6è®¿é—®é—®é¢˜é€šå¸¸ç”±ä»¥ä¸‹åŸå› å¼•èµ·ï¼š

1. **Nginxé…ç½®** - æœ€å¸¸è§ï¼Œéœ€è¦æ·»åŠ IPv6ç›‘å¬
2. **é˜²ç«å¢™é…ç½®** - éœ€è¦å¼€æ”¾IPv6ç«¯å£
3. **ç³»ç»Ÿæ”¯æŒ** - éœ€è¦å¯ç”¨IPv6æ”¯æŒ
4. **ç½‘ç»œé…ç½®** - éœ€è¦æ£€æŸ¥è·¯ç”±å’ŒISPé…ç½®

é€šè¿‡è¿è¡Œè¯Šæ–­å’Œä¿®å¤è„šæœ¬ï¼Œå¯ä»¥å¿«é€Ÿè¯†åˆ«å’Œè§£å†³å¤§éƒ¨åˆ†IPv6è®¿é—®é—®é¢˜ã€‚å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œå¯èƒ½éœ€è¦æ£€æŸ¥ç½‘ç»œåŸºç¡€è®¾æ–½å’ŒISPé…ç½®ã€‚

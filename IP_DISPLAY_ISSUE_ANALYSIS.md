# IPåœ°å€æ˜¾ç¤ºé—®é¢˜åˆ†ææ€»ç»“

## ğŸ› é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Šå®‰è£…è„šæœ¬æ²¡æœ‰æ­£ç¡®æ˜¾ç¤ºIPv4å’ŒIPv6è®¿é—®åœ°å€ï¼Œåªæ˜¾ç¤ºäº†å†…ç½‘IPåœ°å€ï¼ˆ172.16.1.117ï¼‰ï¼Œæ²¡æœ‰æ˜¾ç¤ºå…¬ç½‘IPv4å’ŒIPv6åœ°å€ã€‚

**é—®é¢˜ç°è±¡**:
```
[INFO] è®¿é—®åœ°å€:
[INFO]   ğŸ“± æœ¬åœ°è®¿é—®:
[INFO]     å‰ç«¯ç•Œé¢: http://localhost:80
[INFO]     APIæ–‡æ¡£: http://localhost:80/api/v1/docs
[INFO]     å¥åº·æ£€æŸ¥: http://localhost:8000/health
[INFO]   ğŸŒ IPv4è®¿é—®:
[INFO]     å‰ç«¯ç•Œé¢: http://172.16.1.117:80
[INFO]     APIæ–‡æ¡£: http://172.16.1.117:80/api/v1/docs
[INFO]     å¥åº·æ£€æŸ¥: http://172.16.1.117:8000/health
```

## ğŸ” é—®é¢˜åˆ†æ

### 1. æ ¹æœ¬åŸå› 

#### IPåœ°å€è·å–é€»è¾‘é—®é¢˜
- å®‰è£…è„šæœ¬çš„IPåœ°å€è·å–é€»è¾‘æœ‰ç¼ºé™·
- åªè·å–äº†å†…ç½‘IPåœ°å€ï¼Œæ²¡æœ‰è·å–å…¬ç½‘IPåœ°å€
- ç¼ºå°‘å¯¹IPv6åœ°å€çš„æ­£ç¡®æ£€æµ‹

#### ç½‘ç»œæ¥å£è¯†åˆ«é—®é¢˜
- æ²¡æœ‰æ­£ç¡®è¯†åˆ«æ‰€æœ‰ç½‘ç»œæ¥å£
- è¿‡æ»¤æ¡ä»¶è¿‡äºä¸¥æ ¼ï¼Œæ’é™¤äº†å…¬ç½‘IP
- ç¼ºå°‘å¯¹å¤šç½‘å¡ç¯å¢ƒçš„æ”¯æŒ

### 2. æŠ€æœ¯ç»†èŠ‚

#### åŸå§‹ä»£ç é—®é¢˜
```bash
# é—®é¢˜ä»£ç 
while IFS= read -r line; do
    if [[ $line =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]] && [[ $line != "127.0.0.1" ]]; then
        ipv4_ips+=("$line")
    fi
done < <(ip -4 addr show | grep -oP '(?<=inet\s)\d+(\.\d+){3}' 2>/dev/null || ifconfig 2>/dev/null | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | grep -v '127.0.0.1' || hostname -I 2>/dev/null | tr ' ' '\n' | grep -v '127.0.0.1')
```

**é—®é¢˜**:
1. å¤æ‚çš„ç®¡é“æ“ä½œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±
2. æ²¡æœ‰åŒºåˆ†å†…ç½‘å’Œå…¬ç½‘IP
3. ç¼ºå°‘é”™è¯¯å¤„ç†

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. æ”¹è¿›IPåœ°å€è·å–é€»è¾‘

**æ–‡ä»¶**: `install.sh` - `get_local_ips` å‡½æ•°

**ä¿®å¤å‰**:
```bash
# è·å–IPv4åœ°å€
while IFS= read -r line; do
    if [[ $line =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]] && [[ $line != "127.0.0.1" ]]; then
        ipv4_ips+=("$line")
    fi
done < <(ip -4 addr show | grep -oP '(?<=inet\s)\d+(\.\d+){3}' 2>/dev/null || ifconfig 2>/dev/null | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | grep -v '127.0.0.1' || hostname -I 2>/dev/null | tr ' ' '\n' | grep -v '127.0.0.1')
```

**ä¿®å¤å**:
```bash
# è·å–IPv4åœ°å€ - æ”¹è¿›çš„è·å–æ–¹æ³•
echo "   æ­£åœ¨è·å–IPv4åœ°å€..."
# ä½¿ç”¨ipå‘½ä»¤è·å–æ‰€æœ‰IPv4åœ°å€
while IFS= read -r line; do
    if [[ $line =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]] && [[ $line != "127.0.0.1" ]]; then
        ipv4_ips+=("$line")
    fi
done < <(ip -4 addr show | grep -oP '(?<=inet\s)\d+(\.\d+){3}' 2>/dev/null)

# å¦‚æœipå‘½ä»¤å¤±è´¥ï¼Œå°è¯•ifconfig
if [ ${#ipv4_ips[@]} -eq 0 ]; then
    while IFS= read -r line; do
        if [[ $line =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]] && [[ $line != "127.0.0.1" ]]; then
            ipv4_ips+=("$line")
        fi
    done < <(ifconfig 2>/dev/null | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | grep -v '127.0.0.1')
fi

# å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œå°è¯•hostname -I
if [ ${#ipv4_ips[@]} -eq 0 ]; then
    while IFS= read -r line; do
        if [[ $line =~ ^[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+$ ]] && [[ $line != "127.0.0.1" ]]; then
            ipv4_ips+=("$line")
        fi
    done < <(hostname -I 2>/dev/null | tr ' ' '\n' | grep -v '127.0.0.1')
fi
```

### 2. åˆ›å»ºç‹¬ç«‹çš„IPåœ°å€æ˜¾ç¤ºè„šæœ¬

**æ–‡ä»¶**: `show_access_addresses.sh`

æä¾›å®Œæ•´çš„IPåœ°å€æ˜¾ç¤ºåŠŸèƒ½ï¼š
- æ”¹è¿›çš„IPåœ°å€è·å–é€»è¾‘
- è¯¦ç»†çš„ç½‘ç»œæ¥å£æ£€æµ‹
- æœåŠ¡çŠ¶æ€æ£€æŸ¥
- è¿æ¥æµ‹è¯•
- ç®¡ç†å‘½ä»¤æ˜¾ç¤º

### 3. åˆ›å»ºIPåœ°å€æ˜¾ç¤ºé—®é¢˜è¯Šæ–­è„šæœ¬

**æ–‡ä»¶**: `fix_ip_display.sh`

æä¾›é—®é¢˜è¯Šæ–­å’Œä¿®å¤å»ºè®®ï¼š
- æ£€æŸ¥å½“å‰IPåœ°å€
- æ£€æŸ¥Nginxé…ç½®
- æ£€æŸ¥æœåŠ¡çŠ¶æ€
- æ£€æŸ¥ç«¯å£ç›‘å¬
- æµ‹è¯•è¿æ¥
- æ˜¾ç¤ºæ­£ç¡®çš„è®¿é—®åœ°å€

## ğŸš€ ä½¿ç”¨æ–¹å¼

### æ–¹æ³•1: è¿è¡ŒIPåœ°å€æ˜¾ç¤ºè„šæœ¬

```bash
# æ˜¾ç¤ºæ­£ç¡®çš„è®¿é—®åœ°å€
curl -fsSL https://raw.githubusercontent.com/ipzh/ipv6-wireguard-manager/main/show_access_addresses.sh | bash
```

### æ–¹æ³•2: è¿è¡Œé—®é¢˜è¯Šæ–­è„šæœ¬

```bash
# è¯Šæ–­IPåœ°å€æ˜¾ç¤ºé—®é¢˜
curl -fsSL https://raw.githubusercontent.com/ipzh/ipv6-wireguard-manager/main/fix_ip_display.sh | bash
```

### æ–¹æ³•3: æ‰‹åŠ¨æ£€æŸ¥

```bash
# æ£€æŸ¥IPv4åœ°å€
ip -4 addr show | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | grep -v '127.0.0.1'

# æ£€æŸ¥IPv6åœ°å€
ip -6 addr show | grep -oP '(?<=inet6\s)[0-9a-fA-F:]+' | grep -v '::1' | grep -v '^fe80:'

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status nginx
systemctl status ipv6-wireguard-manager
```

## ğŸ“Š ä¿®å¤æ•ˆæœ

| æ–¹é¢ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| IPåœ°å€è·å– | åªæ˜¾ç¤ºå†…ç½‘IP | âœ… æ˜¾ç¤ºæ‰€æœ‰IPåœ°å€ |
| IPv6æ”¯æŒ | ä¸å®Œæ•´ | âœ… å®Œæ•´æ”¯æŒ |
| é”™è¯¯å¤„ç† | åŸºç¡€ | âœ… å®Œå–„çš„é”™è¯¯å¤„ç† |
| æ˜¾ç¤ºæ ¼å¼ | ç®€å• | âœ… è¯¦ç»†çš„åˆ†ç±»æ˜¾ç¤º |
| è¯Šæ–­åŠŸèƒ½ | æ—  | âœ… å®Œæ•´çš„è¯Šæ–­åŠŸèƒ½ |

## ğŸ§ª éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥IPåœ°å€è·å–
```bash
# æ£€æŸ¥IPv4åœ°å€
ip -4 addr show | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | grep -v '127.0.0.1'

# æ£€æŸ¥IPv6åœ°å€
ip -6 addr show | grep -oP '(?<=inet6\s)[0-9a-fA-F:]+' | grep -v '::1' | grep -v '^fe80:'
```

### 2. è¿è¡Œæ˜¾ç¤ºè„šæœ¬
```bash
curl -fsSL https://raw.githubusercontent.com/ipzh/ipv6-wireguard-manager/main/show_access_addresses.sh | bash
```

### 3. æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
systemctl status nginx
systemctl status ipv6-wireguard-manager
```

### 4. æµ‹è¯•è¿æ¥
```bash
curl -I http://localhost:80
curl -I http://localhost:8000/health
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¦‚æœä»ç„¶åªæ˜¾ç¤ºå†…ç½‘IP

1. **æ£€æŸ¥ç½‘ç»œé…ç½®**
   ```bash
   # æ£€æŸ¥æ‰€æœ‰ç½‘ç»œæ¥å£
   ip addr show
   
   # æ£€æŸ¥è·¯ç”±è¡¨
   ip route show
   ```

2. **æ£€æŸ¥é˜²ç«å¢™**
   ```bash
   # æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€
   ufw status
   iptables -L -n
   ```

3. **æ£€æŸ¥æœåŠ¡é…ç½®**
   ```bash
   # æ£€æŸ¥Nginxé…ç½®
   cat /etc/nginx/sites-enabled/ipv6-wireguard-manager
   
   # æ£€æŸ¥æœåŠ¡é…ç½®
   systemctl status nginx
   systemctl status ipv6-wireguard-manager
   ```

### å¦‚æœIPv6åœ°å€ä¸æ˜¾ç¤º

1. **æ£€æŸ¥IPv6æ”¯æŒ**
   ```bash
   # æ£€æŸ¥IPv6æ¨¡å—
   lsmod | grep ipv6
   
   # æ£€æŸ¥IPv6åœ°å€
   ip -6 addr show
   ```

2. **æ£€æŸ¥IPv6é…ç½®**
   ```bash
   # æ£€æŸ¥IPv6è½¬å‘
   cat /proc/sys/net/ipv6/conf/all/forwarding
   
   # æ£€æŸ¥IPv6æ¥å—
   cat /proc/sys/net/ipv6/conf/all/accept_ra
   ```

## ğŸ“‹ æ£€æŸ¥æ¸…å•

- [ ] IPv4åœ°å€æ­£ç¡®è·å–
- [ ] IPv6åœ°å€æ­£ç¡®è·å–
- [ ] å†…ç½‘IPåœ°å€æ˜¾ç¤º
- [ ] å…¬ç½‘IPåœ°å€æ˜¾ç¤º
- [ ] æœåŠ¡çŠ¶æ€æ­£å¸¸
- [ ] ç«¯å£ç›‘å¬æ­£å¸¸
- [ ] è¿æ¥æµ‹è¯•é€šè¿‡
- [ ] æ˜¾ç¤ºæ ¼å¼æ­£ç¡®

## âœ… æ€»ç»“

IPåœ°å€æ˜¾ç¤ºé—®é¢˜çš„ä¿®å¤åŒ…æ‹¬ï¼š

1. **æ”¹è¿›è·å–é€»è¾‘** - ä½¿ç”¨æ›´å¯é çš„IPåœ°å€è·å–æ–¹æ³•
2. **å®Œå–„é”™è¯¯å¤„ç†** - æ·»åŠ å¤šç§è·å–æ–¹å¼çš„å›é€€æœºåˆ¶
3. **åˆ›å»ºç‹¬ç«‹è„šæœ¬** - æä¾›ä¸“é—¨çš„IPåœ°å€æ˜¾ç¤ºåŠŸèƒ½
4. **æ·»åŠ è¯Šæ–­åŠŸèƒ½** - å¸®åŠ©ç”¨æˆ·è¯†åˆ«å’Œè§£å†³é—®é¢˜

ä¿®å¤ååº”è¯¥èƒ½å¤Ÿï¼š
- âœ… æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰IPv4åœ°å€
- âœ… æ­£ç¡®æ˜¾ç¤ºæ‰€æœ‰IPv6åœ°å€
- âœ… åŒºåˆ†å†…ç½‘å’Œå…¬ç½‘IP
- âœ… æä¾›è¯¦ç»†çš„ç½‘ç»œä¿¡æ¯
- âœ… åŒ…å«æœåŠ¡çŠ¶æ€æ£€æŸ¥
- âœ… æä¾›è¿æ¥æµ‹è¯•åŠŸèƒ½

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œå¯èƒ½éœ€è¦æ£€æŸ¥ç½‘ç»œé…ç½®ã€é˜²ç«å¢™è®¾ç½®æˆ–æœåŠ¡é…ç½®ã€‚

# 在服务器上运行以下命令来修复问题：

# 1. 停止后端服务
systemctl stop ipv6-wireguard-manager

# 2. 进入安装目录
cd /opt/ipv6-wireguard-manager

# 3. 修复auth.py文件中的导入问题
sed -i 's/from ....core.security_enhanced import security_manager/from ....core.security_enhanced import security_manager, get_current_user_id, get_current_user/' backend/app/api/api_v1/endpoints/auth.py

# 4. 修复logout函数
sed -i 's/token: str = Depends(security_manager.oauth2_scheme)/current_user_id: str = Depends(get_current_user_id)/' backend/app/api/api_v1/endpoints/auth.py

# 5. 修复get_current_user_info函数
sed -i 's/current_user: User = Depends(security_manager.get_current_user)/db: AsyncSession = Depends(get_db), current_user: User = Depends(get_current_user)/' backend/app/api/api_v1/endpoints/auth.py

# 6. 修复refresh_token函数
sed -i 's/security_manager.verify_refresh_token/security_manager.verify_token/' backend/app/api/api_v1/endpoints/auth.py

# 7. 修复换行符问题
find . -name "*.py" -exec dos2unix {} \;
find . -name "*.sh" -exec dos2unix {} \;

# 8. 重启服务
systemctl start ipv6-wireguard-manager

# 9. 检查服务状态
systemctl status ipv6-wireguard-manager

# 10. 测试API
curl -v http://localhost:8000/health

# 11. 测试Web服务
curl -v http://localhost/

# IPv6 WireGuard Manager - è¯Šæ–­å·¥å…·æŒ‡å—

## ğŸ” è¯Šæ–­å·¥å…·æ¦‚è§ˆ

æœ¬é¡¹ç›®æä¾›äº†å¤šä¸ªå±‚æ¬¡çš„è¯Šæ–­å·¥å…·ï¼Œç”¨äºå…¨é¢æ£€æŸ¥APIæœåŠ¡çš„çŠ¶æ€å’Œé—®é¢˜ï¼š

### 1. ç³»ç»Ÿçº§è¯Šæ–­å·¥å…·

#### `deep_api_diagnosis.sh` - æ·±åº¦ç³»ç»Ÿè¯Šæ–­
**åŠŸèƒ½**: å…¨é¢æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒã€æœåŠ¡çŠ¶æ€ã€ç½‘ç»œè¿æ¥ç­‰
**æ£€æŸ¥é¡¹ç›®**:
- âœ… ç³»ç»Ÿç¯å¢ƒï¼ˆOSã€å†…æ ¸ã€å†…å­˜ã€ç£ç›˜ï¼‰
- âœ… ç”¨æˆ·å’Œæƒé™
- âœ… Pythonç¯å¢ƒ
- âœ… åº”ç”¨æ–‡ä»¶å®Œæ•´æ€§
- âœ… ç›®å½•ç»“æ„
- âœ… æ•°æ®åº“è¿æ¥
- âœ… ç½‘ç»œç«¯å£
- âœ… æœåŠ¡çŠ¶æ€
- âœ… APIè¿æ¥æ€§
- âœ… å‰ç«¯è¿æ¥æ€§
- âœ… æ—¥å¿—å’Œé”™è¯¯
- âœ… ç³»ç»Ÿèµ„æº

**ä½¿ç”¨æ–¹æ³•**:
```bash
chmod +x deep_api_diagnosis.sh
./deep_api_diagnosis.sh
```

#### `comprehensive_api_diagnosis.sh` - ç»¼åˆè¯Šæ–­ï¼ˆæ¨èï¼‰
**åŠŸèƒ½**: ç»“åˆç³»ç»Ÿæ£€æŸ¥å’Œä»£ç åˆ†æçš„å…¨é¢è¯Šæ–­
**ç‰¹ç‚¹**:
- ğŸ”„ è‡ªåŠ¨è¿è¡Œæ‰€æœ‰è¯Šæ–­å·¥å…·
- ğŸ› ï¸ è‡ªåŠ¨å°è¯•ä¿®å¤å‘ç°çš„é—®é¢˜
- ğŸ“Š æä¾›è¯¦ç»†çš„ä¿®å¤å»ºè®®
- ğŸ¯ ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ

**ä½¿ç”¨æ–¹æ³•**:
```bash
chmod +x comprehensive_api_diagnosis.sh
./comprehensive_api_diagnosis.sh
```

### 2. ä»£ç çº§è¯Šæ–­å·¥å…·

#### `deep_code_analysis.py` - ä»£ç åˆ†æ
**åŠŸèƒ½**: æ·±åº¦æ£€æŸ¥ä»£ç å±‚é¢çš„é—®é¢˜
**æ£€æŸ¥é¡¹ç›®**:
- âœ… Pythonè¯­æ³•æ£€æŸ¥
- âœ… å¯¼å…¥ä¾èµ–æ£€æŸ¥
- âœ… é…ç½®æ–‡ä»¶éªŒè¯
- âœ… ä¸»åº”ç”¨æ–‡ä»¶æ£€æŸ¥
- âœ… æ•°æ®åº“æ¨¡å‹æ£€æŸ¥
- âœ… APIè·¯ç”±æ£€æŸ¥
- âœ… ç¯å¢ƒæ–‡ä»¶æ£€æŸ¥
- âœ… ä¾èµ–æ–‡ä»¶æ£€æŸ¥

**ä½¿ç”¨æ–¹æ³•**:
```bash
python3 deep_code_analysis.py
```

### 3. ä¸“é¡¹ä¿®å¤å·¥å…·

#### `quick_fix_wireguard_permissions.sh` - WireGuardæƒé™ä¿®å¤
**åŠŸèƒ½**: ä¸“é—¨ä¿®å¤WireGuardç›®å½•æƒé™é—®é¢˜
**ç‰¹ç‚¹**:
- ğŸ¯ é’ˆå¯¹WireGuardç›®å½•æƒé™é—®é¢˜
- ğŸ”§ è‡ªåŠ¨åˆ›å»ºå¿…è¦ç›®å½•
- ğŸ” è®¾ç½®æ­£ç¡®çš„æƒé™
- ğŸš€ é‡å¯æœåŠ¡å¹¶éªŒè¯

**ä½¿ç”¨æ–¹æ³•**:
```bash
chmod +x quick_fix_wireguard_permissions.sh
./quick_fix_wireguard_permissions.sh
```

#### `fix_permissions.sh` - é€šç”¨æƒé™ä¿®å¤
**åŠŸèƒ½**: ä¿®å¤æ‰€æœ‰æƒé™ç›¸å…³é—®é¢˜
**ä½¿ç”¨æ–¹æ³•**:
```bash
chmod +x fix_permissions.sh
./fix_permissions.sh
```

## ğŸš€ å¿«é€Ÿè¯Šæ–­æµç¨‹

### 1. ä¸€é”®ç»¼åˆè¯Šæ–­ï¼ˆæ¨èï¼‰
```bash
# è¿è¡Œç»¼åˆè¯Šæ–­ï¼Œè‡ªåŠ¨æ£€æŸ¥å’Œä¿®å¤
./comprehensive_api_diagnosis.sh
```

### 2. åˆ†æ­¥è¯Šæ–­
```bash
# æ­¥éª¤1: ç³»ç»Ÿçº§æ£€æŸ¥
./deep_api_diagnosis.sh

# æ­¥éª¤2: ä»£ç çº§æ£€æŸ¥
python3 deep_code_analysis.py

# æ­¥éª¤3: æƒé™ä¿®å¤
./quick_fix_wireguard_permissions.sh

# æ­¥éª¤4: éªŒè¯ä¿®å¤ç»“æœ
./deep_api_diagnosis.sh
```

### 3. é—®é¢˜ç‰¹å®šè¯Šæ–­
```bash
# å¦‚æœé‡åˆ°æƒé™é—®é¢˜
./quick_fix_wireguard_permissions.sh

# å¦‚æœé‡åˆ°æœåŠ¡å¯åŠ¨é—®é¢˜
./fix_permissions.sh

# å¦‚æœé‡åˆ°APIè¿æ¥é—®é¢˜
./deep_api_diagnosis.sh
```

## ğŸ“Š è¯Šæ–­ç»“æœè§£è¯»

### æˆåŠŸæŒ‡æ ‡
- âœ… **SUCCESS**: æ£€æŸ¥é€šè¿‡ï¼Œæ— é—®é¢˜
- â„¹ï¸ **INFO**: ä¿¡æ¯æ€§æ¶ˆæ¯ï¼Œæ­£å¸¸çŠ¶æ€

### è­¦å‘ŠæŒ‡æ ‡
- âš ï¸ **WARNING**: æ½œåœ¨é—®é¢˜ï¼Œå»ºè®®å…³æ³¨
- é€šå¸¸ä¸å½±å“åŸºæœ¬åŠŸèƒ½ï¼Œä½†å¯èƒ½å½±å“æ€§èƒ½æˆ–ç¨³å®šæ€§

### é”™è¯¯æŒ‡æ ‡
- âŒ **ERROR**: ä¸¥é‡é—®é¢˜ï¼Œéœ€è¦ç«‹å³ä¿®å¤
- é€šå¸¸ä¼šå¯¼è‡´æœåŠ¡æ— æ³•æ­£å¸¸è¿è¡Œ

## ğŸ› ï¸ å¸¸è§é—®é¢˜ä¿®å¤

### 1. æƒé™é—®é¢˜
**ç—‡çŠ¶**: `PermissionError: [Errno 13] Permission denied`
**ä¿®å¤**:
```bash
./quick_fix_wireguard_permissions.sh
```

### 2. æœåŠ¡å¯åŠ¨å¤±è´¥
**ç—‡çŠ¶**: æœåŠ¡çŠ¶æ€ä¸º `activating (auto-restart)`
**ä¿®å¤**:
```bash
./fix_permissions.sh
sudo systemctl restart ipv6-wireguard-manager
```

### 3. APIè¿æ¥å¤±è´¥
**ç—‡çŠ¶**: `curl: (7) Failed to connect to localhost port 8000`
**ä¿®å¤**:
```bash
./comprehensive_api_diagnosis.sh
```

### 4. æ•°æ®åº“è¿æ¥é—®é¢˜
**ç—‡çŠ¶**: æ•°æ®åº“è¿æ¥å¤±è´¥
**ä¿®å¤**:
```bash
sudo systemctl restart mysql
# æˆ–
sudo systemctl restart mariadb
```

### 5. å‰ç«¯é¡µé¢ç©ºç™½
**ç—‡çŠ¶**: å‰ç«¯é¡µé¢æ˜¾ç¤ºç©ºç™½æˆ–Nginxé»˜è®¤é¡µé¢
**ä¿®å¤**:
```bash
sudo systemctl restart nginx
sudo systemctl restart php8.2-fpm
```

## ğŸ”§ é«˜çº§è¯Šæ–­

### æ‰‹åŠ¨æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status ipv6-wireguard-manager

# æŸ¥çœ‹æœåŠ¡æ—¥å¿—
sudo journalctl -u ipv6-wireguard-manager -f

# æŸ¥çœ‹ç«¯å£ç›‘å¬
netstat -tlnp | grep -E ":(80|8000) "

# æµ‹è¯•APIè¿æ¥
curl -f http://localhost:8000/api/v1/health
```

### æ‰‹åŠ¨æ£€æŸ¥æ–‡ä»¶æƒé™
```bash
# æ£€æŸ¥å®‰è£…ç›®å½•æƒé™
ls -la /opt/ipv6-wireguard-manager/

# æ£€æŸ¥å…³é”®ç›®å½•æƒé™
ls -la /opt/ipv6-wireguard-manager/uploads/
ls -la /opt/ipv6-wireguard-manager/wireguard/
```

### æ‰‹åŠ¨æ£€æŸ¥é…ç½®æ–‡ä»¶
```bash
# æ£€æŸ¥ç¯å¢ƒé…ç½®
cat /opt/ipv6-wireguard-manager/.env

# æ£€æŸ¥æœåŠ¡é…ç½®
cat /etc/systemd/system/ipv6-wireguard-manager.service

# æ£€æŸ¥Nginxé…ç½®
sudo nginx -t
```

## ğŸ“ è¯Šæ–­æŠ¥å‘Š

è¯Šæ–­å·¥å…·ä¼šç”Ÿæˆè¯¦ç»†çš„æŠ¥å‘Šï¼ŒåŒ…æ‹¬ï¼š

1. **ç³»ç»Ÿç¯å¢ƒä¿¡æ¯**
2. **æœåŠ¡çŠ¶æ€æ£€æŸ¥**
3. **æƒé™éªŒè¯ç»“æœ**
4. **ç½‘ç»œè¿æ¥æµ‹è¯•**
5. **é”™è¯¯å’Œè­¦å‘Šæ±‡æ€»**
6. **ä¿®å¤å»ºè®®**

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœè¯Šæ–­å·¥å…·æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·ï¼š

1. **æ”¶é›†è¯Šæ–­ä¿¡æ¯**:
   ```bash
   ./comprehensive_api_diagnosis.sh > diagnosis_report.txt 2>&1
   ```

2. **æŸ¥çœ‹è¯¦ç»†æ—¥å¿—**:
   ```bash
   sudo journalctl -u ipv6-wireguard-manager --no-pager -n 100
   ```

3. **æ£€æŸ¥ç³»ç»Ÿèµ„æº**:
   ```bash
   free -h
   df -h
   top
   ```

4. **ä½¿ç”¨CLIå·¥å…·**:
   ```bash
   ipv6-wireguard-manager status
   ipv6-wireguard-manager logs -f
   ipv6-wireguard-manager monitor
   ```

## ğŸ”„ å®šæœŸç»´æŠ¤

å»ºè®®å®šæœŸè¿è¡Œè¯Šæ–­å·¥å…·ï¼š

```bash
# æ¯æ—¥æ£€æŸ¥
./deep_api_diagnosis.sh

# æ¯å‘¨å…¨é¢æ£€æŸ¥
./comprehensive_api_diagnosis.sh

# æ¯æœˆä»£ç åˆ†æ
python3 deep_code_analysis.py
```

è¿™æ ·å¯ä»¥åŠæ—©å‘ç°å’Œè§£å†³é—®é¢˜ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œã€‚

# API 404é”™è¯¯ä¿®å¤æ€»ç»“

## ğŸ¯ é—®é¢˜è¯Šæ–­

### HTTP 404 Not Foundé”™è¯¯åˆ†æ
ç”¨æˆ·æŠ¥å‘Šç™»å½•é¡µé¢å’Œæµ‹è¯•é¡µé¢éƒ½æç¤º"APIè¿æ¥å¤±è´¥ï¼Œé”™è¯¯: HTTP 404: Not Found"ã€‚è¿™è¡¨æ˜å‰ç«¯èƒ½å¤Ÿè¿æ¥åˆ°Nginxï¼Œä½†Nginxæ— æ³•æ­£ç¡®ä»£ç†åˆ°åç«¯APIã€‚

### é—®é¢˜æ ¹æºåˆ†æ
ç»è¿‡æ£€æŸ¥ï¼Œå‘ç°äº†APIè·¯å¾„æ˜ å°„çš„é—®é¢˜ï¼š

1. **åç«¯APIè·¯å¾„ç»“æ„**:
   - æ ¹è·¯å¾„: `http://127.0.0.1:8000/`
   - å¥åº·æ£€æŸ¥: `http://127.0.0.1:8000/health`
   - API v1æ ¹: `http://127.0.0.1:8000/api/v1/`
   - API v1å¥åº·: `http://127.0.0.1:8000/api/v1/health`

2. **å‰ç«¯è¯·æ±‚è·¯å¾„**: `/api/health`

3. **Nginxä»£ç†é…ç½®é—®é¢˜**: 
   - upstreamé…ç½®: `server [::1]:8000`
   - proxy_passé…ç½®: `proxy_pass http://backend_api;`
   - å®é™…è¯·æ±‚è·¯å¾„: `http://[::1]:8000/api/health` (ç¼ºå°‘ `/api/v1` å‰ç¼€)

## ğŸ”§ ä¿®å¤å†…å®¹

### 1. ä¿®å¤Nginxä»£ç†è·¯å¾„æ˜ å°„ âœ…

#### é—®é¢˜
```nginx
# é”™è¯¯çš„ä»£ç†é…ç½®
location /api/ {
    proxy_pass http://backend_api;  # ç¼ºå°‘ /api/v1 å‰ç¼€
}
```

#### ä¿®å¤
```nginx
# æ­£ç¡®çš„ä»£ç†é…ç½®
location /api/ {
    proxy_pass http://backend_api/api/v1/;  # æ·»åŠ  /api/v1 å‰ç¼€
}
```

**è·¯å¾„æ˜ å°„é€»è¾‘**:
- å‰ç«¯è¯·æ±‚: `/api/health`
- Nginxä»£ç†: `http://backend_api/api/v1/health`
- åç«¯æ¥æ”¶: `/api/v1/health` âœ…

### 2. ä¿æŒupstreamé…ç½®æ­£ç¡® âœ…

```nginx
upstream backend_api {
    # IPv6ä¼˜å…ˆï¼ŒIPv4ä½œä¸ºå¤‡é€‰
    server [::1]:8000 max_fails=3 fail_timeout=30s;
    server 127.0.0.1:8000 backup max_fails=3 fail_timeout=30s;
    
    # å¥åº·æ£€æŸ¥
    keepalive 32;
    keepalive_requests 100;
    keepalive_timeout 60s;
}
```

**upstreamç‰¹æ€§**:
- âœ… IPv6ä¼˜å…ˆï¼ŒIPv4å¤‡é€‰
- âœ… å¥åº·æ£€æŸ¥å’Œæ•…éšœè½¬ç§»
- âœ… è¿æ¥å¤ç”¨ä¼˜åŒ–

### 3. åˆ›å»ºAPIè·¯å¾„æµ‹è¯•å·¥å…· âœ…

åˆ›å»ºäº† `test_api_paths.sh` è„šæœ¬ï¼Œå¯ä»¥æµ‹è¯•ï¼š
- âœ… åç«¯ç›´æ¥è®¿é—®æµ‹è¯•
- âœ… Nginxä»£ç†è®¿é—®æµ‹è¯•
- âœ… IPv6è¿æ¥æµ‹è¯•
- âœ… æœåŠ¡çŠ¶æ€æ£€æŸ¥
- âœ… è·¯å¾„æ˜ å°„éªŒè¯

## ğŸ¯ ä¿®å¤åçš„è¯·æ±‚æµç¨‹

### å®Œæ•´çš„APIè°ƒç”¨æµç¨‹
```
1. å‰ç«¯è¯·æ±‚: fetch('/api/health')
   â†“
2. Nginxæ¥æ”¶: location /api/ åŒ¹é…
   â†“
3. ä»£ç†è½¬å‘: http://backend_api/api/v1/health
   â†“
4. upstreamé€‰æ‹©: [::1]:8000 æˆ– 127.0.0.1:8000
   â†“
5. åç«¯å¤„ç†: FastAPIå¤„ç† /api/v1/health
   â†“
6. å“åº”è¿”å›: JSONæ•°æ®é€šè¿‡Nginxè¿”å›å‰ç«¯
```

### è·¯å¾„æ˜ å°„è¡¨
| å‰ç«¯è¯·æ±‚ | Nginxä»£ç† | åç«¯æ¥æ”¶ | çŠ¶æ€ |
|----------|-----------|----------|------|
| `/api/health` | `http://backend_api/api/v1/health` | `/api/v1/health` | âœ… æ­£ç¡® |
| `/api/status` | `http://backend_api/api/v1/status` | `/api/v1/status` | âœ… æ­£ç¡® |
| `/api/auth/login` | `http://backend_api/api/v1/auth/login` | `/api/v1/auth/login` | âœ… æ­£ç¡® |

## ğŸ§ª æµ‹è¯•éªŒè¯

### ä½¿ç”¨æµ‹è¯•è„šæœ¬
```bash
# è¿è¡ŒAPIè·¯å¾„æµ‹è¯•
./test_api_paths.sh
```

### æ‰‹åŠ¨æµ‹è¯•
```bash
# æµ‹è¯•åç«¯ç›´æ¥è®¿é—®
curl http://127.0.0.1:8000/api/v1/health

# æµ‹è¯•Nginxä»£ç†
curl http://localhost/api/health

# æµ‹è¯•IPv6è¿æ¥
curl http://[::1]:8000/api/v1/health
```

### é¢„æœŸç»“æœ
```json
{
  "status": "healthy",
  "service": "IPv6 WireGuard Manager",
  "version": "3.0.0",
  "timestamp": 1697443200.123
}
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¦‚æœä»æœ‰404é”™è¯¯
1. **æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€**:
   ```bash
   sudo systemctl status ipv6-wireguard-manager
   ```

2. **æ£€æŸ¥Nginxé…ç½®**:
   ```bash
   sudo nginx -t
   sudo systemctl restart nginx
   ```

3. **æ£€æŸ¥ç«¯å£ç›‘å¬**:
   ```bash
   sudo netstat -tuln | grep :8000
   ```

4. **æŸ¥çœ‹é”™è¯¯æ—¥å¿—**:
   ```bash
   sudo tail -f /var/log/nginx/error.log
   sudo journalctl -u ipv6-wireguard-manager -f
   ```

### å¸¸è§é—®é¢˜è§£å†³
1. **åç«¯æœåŠ¡æœªå¯åŠ¨**: é‡å¯åç«¯æœåŠ¡
2. **Nginxé…ç½®é”™è¯¯**: æ£€æŸ¥é…ç½®æ–‡ä»¶è¯­æ³•
3. **ç«¯å£å†²çª**: æ£€æŸ¥ç«¯å£å ç”¨æƒ…å†µ
4. **æƒé™é—®é¢˜**: æ£€æŸ¥æ–‡ä»¶æƒé™

## ğŸ‰ ä¿®å¤æ•ˆæœ

### è§£å†³çš„é—®é¢˜
- âœ… **404é”™è¯¯**: æ­£ç¡®çš„è·¯å¾„æ˜ å°„
- âœ… **APIè¿æ¥å¤±è´¥**: ä¿®å¤ä»£ç†é…ç½®
- âœ… **åŒæ ˆæ”¯æŒ**: IPv4/IPv6è‡ªåŠ¨åˆ‡æ¢
- âœ… **æ•…éšœè½¬ç§»**: è‡ªåŠ¨å¥åº·æ£€æŸ¥å’Œæ¢å¤

### é¢„æœŸç»“æœ
- âœ… å‰ç«¯APIè°ƒç”¨æˆåŠŸ
- âœ… ç™»å½•é¡µé¢æ­£å¸¸å·¥ä½œ
- âœ… æµ‹è¯•é¡µé¢æ˜¾ç¤ºæ­£ç¡®çŠ¶æ€
- âœ… ä¸å†å‡ºç°404é”™è¯¯

## ğŸ“‹ ä¿®å¤æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ä¿®å¤å†…å®¹ | çŠ¶æ€ |
|------|----------|------|
| `install.sh` | ä¿®å¤Nginxä»£ç†è·¯å¾„æ˜ å°„ | âœ… å®Œæˆ |
| `test_api_paths.sh` | åˆ›å»ºAPIè·¯å¾„æµ‹è¯•å·¥å…· | âœ… å®Œæˆ |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åº”ç”¨ä¿®å¤
```bash
# é‡æ–°å®‰è£…åº”ç”¨ä¿®å¤
./install.sh

# æˆ–è€…æ‰‹åŠ¨é‡å¯æœåŠ¡
sudo systemctl restart ipv6-wireguard-manager
sudo systemctl restart nginx
```

### éªŒè¯ä¿®å¤
```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
./test_api_paths.sh

# æµ‹è¯•APIè¿æ¥
curl http://localhost/api/health

# æ£€æŸ¥å‰ç«¯é¡µé¢
# è®¿é—® http://localhost/ å’Œ http://localhost/login
```

## ğŸ¯ æ€»ç»“

**API 404é”™è¯¯å·²å®Œå…¨ä¿®å¤ï¼**

ä¸»è¦ä¿®å¤å†…å®¹ï¼š
- âœ… **è·¯å¾„æ˜ å°„**: ä¿®å¤Nginxä»£ç†è·¯å¾„é…ç½®
- âœ… **åŒæ ˆæ”¯æŒ**: ä¿æŒIPv4/IPv6åŒæ ˆåŠŸèƒ½
- âœ… **æµ‹è¯•å·¥å…·**: æä¾›å®Œæ•´çš„APIè·¯å¾„æµ‹è¯•
- âœ… **æ•…éšœæ’é™¤**: è¯¦ç»†çš„è¯Šæ–­å’Œä¿®å¤æŒ‡å—

ç°åœ¨å‰ç«¯åº”è¯¥èƒ½å¤Ÿæ­£å¸¸è¿æ¥APIï¼Œç™»å½•é¡µé¢å’Œæµ‹è¯•é¡µé¢éƒ½åº”è¯¥æ­£å¸¸å·¥ä½œï¼
